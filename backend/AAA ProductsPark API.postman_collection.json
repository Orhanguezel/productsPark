{
  "info": {
    "_postman_id": "e2c9c6e7-6d4f-47d6-9a0a-3b1f1a0c8a22",
    "name": "AAA Products Admin (New)",
    "description": "FE admin paneli için Products Admin endpoint'leri (cookie-first auth ile uyumlu).",
    "schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json",
    "_exporter_id": "20528167"
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Cookie-first: Authorization header'ını ancak açıkça istenirse ekle",
          "const preferHeader = pm.environment.get('prefer_header_auth') === '1';",
          "const at = pm.environment.get('access_token');",
          "if (preferHeader && at) {",
          "  pm.request.headers.upsert({ key: 'Authorization', value: `Bearer ${at}` });",
          "} else {",
          "  pm.request.headers.remove('Authorization');",
          "}"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "Products Admin",
      "item": [
        {
          "name": "List Products (admin)",
          "event": [
            {
              "listen": "test",
              "script": { "type": "text/javascript", "exec": ["pm.test('OK', () => pm.response.to.have.status(200));"] }
            }
          ],
          "request": {
            "auth": { "type": "noauth" },
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/admin/products?q={{admin_q}}&category_id={{category_id}}&is_active={{admin_is_active}}&show_on_homepage={{admin_show_on_homepage}}&min_price={{admin_min_price}}&max_price={{admin_max_price}}&limit={{admin_limit}}&offset={{admin_offset}}&sort={{admin_sort}}&order={{admin_order}}",
              "host": ["{{base_url}}"],
              "path": ["admin", "products"],
              "query": [
                { "key": "q", "value": "{{admin_q}}" },
                { "key": "category_id", "value": "{{category_id}}" },
                { "key": "is_active", "value": "{{admin_is_active}}" },
                { "key": "show_on_homepage", "value": "{{admin_show_on_homepage}}" },
                { "key": "min_price", "value": "{{admin_min_price}}" },
                { "key": "max_price", "value": "{{admin_max_price}}" },
                { "key": "limit", "value": "{{admin_limit}}" },
                { "key": "offset", "value": "{{admin_offset}}" },
                { "key": "sort", "value": "{{admin_sort}}" },
                { "key": "order", "value": "{{admin_order}}" }
              ]
            }
          }
        },
        {
          "name": "Get Product (admin) by ID",
          "event": [
            {
              "listen": "test",
              "script": { "type": "text/javascript", "exec": ["pm.test('OK', () => pm.response.to.have.status(200));"] }
            }
          ],
          "request": { "auth": { "type": "noauth" }, "method": "GET", "url": "{{base_url}}/admin/products/{{admin_product_id}}" }
        },
        {
          "name": "Create Product (admin)",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.environment.set('ts', Date.now());",
                  "pm.environment.set('ts_iso', new Date().toISOString());"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Created 201', () => pm.response.to.have.status(201));",
                  "const j = pm.response.json();",
                  "if (j && j.id) {",
                  "  pm.environment.set('admin_product_id', j.id);",
                  "  pm.environment.set('admin_product_slug', j.slug);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Admin Ürün {{ts}}\",\n  \"slug\": \"admin-urun-{{ts}}\",\n  \"price\": 149.9,\n  \"original_price\": 199.9,\n  \"short_description\": \"Kısa açıklama (admin)\",\n  \"description\": \"<p>Uzun açıklama (admin)</p>\",\n  \"category_id\": \"{{category_id}}\",\n  \"image_url\": \"https://picsum.photos/seed/admin{{ts}}/800/600\",\n  \"gallery_urls\": [\"https://picsum.photos/seed/admin{{ts}}a/800/600\"],\n  \"features\": [\"Özellik 1\",\"Özellik 2\"],\n  \"rating\": 4.5,\n  \"review_count\": 10,\n  \"product_type\": \"software\",\n  \"delivery_type\": \"manual\",\n  \"custom_fields\": [\n    {\"id\": \"email\", \"label\":\"E-Posta\", \"type\":\"email\", \"required\": true}\n  ],\n  \"quantity_options\": [ {\"quantity\":1, \"price\":149.9}, {\"quantity\":5, \"price\":699.0} ],\n  \"demo_url\": null,\n  \"demo_embed_enabled\": 0,\n  \"badges\": [ {\"text\":\"Yeni\",\"icon\":\"Sparkles\",\"active\":true} ],\n  \"sku\": \"SKU-ADM-{{ts}}\",\n  \"stock_quantity\": 0,\n  \"is_active\": 1,\n  \"is_featured\": 0,\n  \"requires_shipping\": 1\n}"
            },
            "url": "{{base_url}}/admin/products"
          }
        },
        {
          "name": "Update Product (admin)",
          "request": {
            "auth": { "type": "noauth" },
            "method": "PATCH",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "raw": "{\n  \"price\": 129.9,\n  \"is_active\": 1\n}" },
            "url": "{{base_url}}/admin/products/{{admin_product_id}}"
          }
        },
        {
          "name": "Delete Product (admin)",
          "request": { "auth": { "type": "noauth" }, "method": "DELETE", "url": "{{base_url}}/admin/products/{{admin_product_id}}" }
        },
        {
          "name": "Bulk Set Active (admin)",
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "raw": "{\n  \"ids\": [\"{{admin_product_id}}\"],\n  \"is_active\": true\n}" },
            "url": "{{base_url}}/admin/products/bulk/active"
          }
        },
        {
          "name": "Reorder Products (admin)",
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "raw": "{\n  \"items\": [ { \"id\": \"{{admin_product_id}}\", \"display_order\": 10 } ]\n}" },
            "url": "{{base_url}}/admin/products/bulk/reorder"
          }
        },
        {
          "name": "Toggle Active (admin)",
          "request": {
            "auth": { "type": "noauth" },
            "method": "PATCH",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "raw": "{\n  \"is_active\": true\n}" },
            "url": "{{base_url}}/admin/products/{{admin_product_id}}/active"
          }
        },
        {
          "name": "Toggle Homepage (admin)",
          "request": {
            "auth": { "type": "noauth" },
            "method": "PATCH",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": { "mode": "raw", "raw": "{\n  \"show_on_homepage\": true\n}" },
            "url": "{{base_url}}/admin/products/{{admin_product_id}}/homepage"
          }
        },
        {
          "name": "Replace Reviews (admin)",
          "event": [
            {
              "listen": "prerequest",
              "script": { "type": "text/javascript", "exec": ["pm.environment.set('ts_iso', new Date().toISOString());"] }
            },
            {
              "listen": "test",
              "script": { "type": "text/javascript", "exec": ["pm.test('OK', () => pm.response.to.have.status(200));"] }
            }
          ],
          "request": {
            "auth": { "type": "noauth" },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reviews\": [\n    {\"customer_name\": \"Ada\", \"rating\": 5, \"comment\": \"Harika!\", \"review_date\": \"{{ts_iso}}\", \"is_active\": true},\n    {\"customer_name\": \"Can\", \"rating\": 4, \"comment\": \"İyi\", \"review_date\": \"{{ts_iso}}\", \"is_active\": true}\n  ]\n}"
            },
            "url": "{{base_url}}/admin/products/{{admin_product_id}}/reviews"
          }
        },
        {
          "name": "Replace FAQs (admin)",
          "request": {
            "auth": { "type": "noauth" },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"faqs\": [\n    {\"question\": \"Nasıl kurulur?\", \"answer\": \"Kurulum sihirbazını izleyin.\", \"display_order\": 1, \"is_active\": true},\n    {\"question\": \"İade var mı?\", \"answer\": \"14 gün içinde iade.\", \"display_order\": 2, \"is_active\": true}\n  ]\n}"
            },
            "url": "{{base_url}}/admin/products/{{admin_product_id}}/faqs"
          }
        },
        {
          "name": "Set Stock Codes (admin)",
          "request": {
            "auth": { "type": "noauth" },
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"lines\": [\"KEY-{{ts}}-A\", \"KEY-{{ts}}-B\", \"KEY-{{ts}}-C\"]\n}"
            },
            "url": "{{base_url}}/admin/products/{{admin_product_id}}/stock"
          }
        },
        {
          "name": "List Used Stock (admin)",
          "request": { "auth": { "type": "noauth" }, "method": "GET", "url": "{{base_url}}/admin/products/{{admin_product_id}}/stock/used" }
        },
        {
          "name": "List Admin Categories",
          "request": { "auth": { "type": "noauth" }, "method": "GET", "url": "{{base_url}}/admin/categories" }
        },
        {
          "name": "List API Providers (active only)",
          "request": { "auth": { "type": "noauth" }, "method": "GET", "url": "{{base_url}}/admin/api-providers?is_active=1" }
        }
      ]
    }
  ],
  "auth": { "type": "noauth" }
}
